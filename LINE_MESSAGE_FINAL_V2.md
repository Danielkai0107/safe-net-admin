# LINE 通知訊息 - 最終版本 v2

## 📱 完整訊息結構

### 商家完整版

```
┌─────────────────────────────────────┐
│  ┌────────────────────────────┐    │
│  │    [Banner 圖片 3:1]       │    │  ← Hero: imageLink
│  └────────────────────────────┘    │
├─────────────────────────────────────┤
│                                     │
│  小明的手環 已經過                  │  ← Body: 通知主旨
│  星巴克信義店                       │     (特大、青綠色)
│                                     │
│  ───────────────────                │  ← Body: 分隔線
│                                     │
│  設備：小明的手環                   │  ← Body: 詳細資訊
│  地點：星巴克信義店                 │
│  時間：2026/01/29 14:30            │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ┌──────────────────────────┐      │
│  │      查看地圖            │      │  ← Footer: 主按鈕（青綠色）
│  └──────────────────────────┘      │
│                                     │
│  ───────────────────                │  ← Footer: 分隔線
│                                     │
│  [🏪]  星巴克信義店                │  ← Footer: Logo + 店名
│   48px                              │     (僅商家、有Logo時)
│                                     │
│  ───────────────────                │  ← Footer: 分隔線
│                                     │
│  商家優惠                           │  ← Footer: 商家優惠區塊
│  春節特惠活動                       │
│  全店商品 8 折優惠...              │
│                                     │
│  ┌──────────────────────────┐      │
│  │      店家資訊            │      │  ← Footer: 次按鈕（灰色邊框）
│  └──────────────────────────┘      │
│                                     │
│  此通知由您設定的通知點自動發送     │
│                                     │
└─────────────────────────────────────┘
```

## 📊 區塊順序

### Body（內容區）

1. 通知主旨：「已通過 location」
2. 分隔線
3. 詳細資訊：設備、地點、時間

### Footer（操作區）

4. **[查看地圖]** - 青綠色主按鈕
5. 分隔線
6. **[Logo] + 店名** - 商家識別（僅商家有 Logo 時）
7. 分隔線（僅當有 Logo + 店名時）
8. **商家優惠** - 優惠內容（僅商家有優惠時）
9. **[店家資訊]** - 灰色邊框次按鈕（僅有 websiteLink 時）
10. 底部提示文字

## 🎨 按鈕樣式

### 主按鈕：查看地圖

```typescript
{
  style: "primary",
  color: "#4ECDC4"
}
```

**效果**：

```
┌──────────────────────┐
│    查看地圖          │  ← 青綠色實心、白色文字
└──────────────────────┘
```

### 次按鈕：店家資訊

```typescript
{
  style: "secondary",
  color: "#999999"
}
```

**效果**：

```
┌──────────────────────┐
│    店家資訊          │  ← 灰色邊框、灰色文字、白色背景
└──────────────────────┘
```

## 🔄 不同情境顯示

### 情境 A：完整商家（Banner + Logo + 優惠）

```
[Banner 3:1] ← Hero
已通過 星巴克
─────────
設備、地點、時間
─────────
[查看地圖] 青綠色
─────────
[Logo] 星巴克信義店
─────────
商家優惠
春節特惠活動
全店8折...
[店家資訊] 灰色邊框      ← 有邊框！
```

### 情境 B：商家（只有 Logo，無 Banner）

```
已通過 7-11              ← 無 Hero
─────────
設備、地點、時間
─────────
[查看地圖]
─────────
[Logo] 7-11光復門市      ← 有 Logo 區塊
─────────
商家優惠
集點活動...
[店家資訊] 灰色邊框
```

### 情境 C：商家（有 Banner，無 Logo）

```
[Banner 3:1]             ← Hero
已通過 全家
─────────
設備、地點、時間
─────────
[查看地圖]
─────────                 ← 無 Logo 區塊
商家優惠                  ← 直接顯示優惠
限時特價...
[店家資訊] 灰色邊框
```

### 情境 D：一般 Gateway

```
已通過 大安公園          ← 無 Hero
─────────
設備、地點、時間
─────────
[查看地圖]               ← 只有這個按鈕
底部提示
```

## 💻 關鍵代碼

### Footer 結構

```typescript
footer: {
  contents: [
    // 1. 查看地圖按鈕
    {
      type: "button",
      style: "primary",
      color: "#4ECDC4",
      label: "查看地圖",
    },

    // 2. 商家 Logo + 店名（條件顯示）
    ...(isStore && data.storeLogo
      ? [
          { type: "separator", margin: "lg" },
          {
            type: "box",
            layout: "horizontal",
            contents: [
              {
                type: "image",
                url: data.storeLogo,
                size: "xs", // 48px
                aspectRatio: "1:1",
              },
              {
                type: "text",
                text: data.gatewayName,
                size: "lg",
                weight: "bold",
                gravity: "center",
              },
            ],
          },
        ]
      : []),

    // 3. 商家優惠區塊（條件顯示）
    ...(data.isAD && (data.activityTitle || data.websiteLink)
      ? [
          { type: "separator", margin: "lg" },
          {
            type: "box",
            contents: [
              { type: "text", text: "商家優惠" },
              { type: "text", text: data.activityTitle },
              { type: "text", text: data.activityContent },
              // 店家資訊按鈕
              {
                type: "button",
                style: "secondary", // ← 有邊框
                color: "#999999", // ← 灰色
                label: "店家資訊",
              },
            ],
          },
        ]
      : []),

    // 4. 底部提示
    { type: "text", text: "此通知由您設定的通知點自動發送" },
  ];
}
```

## 🎨 視覺層級

### 操作區順序（重要性）

```
1. [查看地圖] 主按鈕
      ↓ (青綠色實心，最重要)
2. 分隔線
      ↓
3. [Logo] 店名 (商家識別)
      ↓ (僅商家顯示)
4. 分隔線
      ↓
5. 商家優惠內容
      ↓ (附加價值)
6. [店家資訊] 次按鈕
      ↓ (灰色邊框，次要操作)
7. 底部提示
```

## 📏 間距與分隔線

### 分隔線使用邏輯

```
Body 區域：
  已通過 location
  ─────────── (永遠有)
  設備、地點、時間

Footer 區域：
  [查看地圖]
  ─────────── (商家且有Logo時才有)
  [Logo] 店名
  ─────────── (商家且有優惠時才有)
  商家優惠...
  [店家資訊]
```

### 為什麼這樣設計？

1. **查看地圖下方的分隔線**：
   - 只有當有商家 Logo 時才顯示
   - 目的：區隔主按鈕和商家識別區
2. **Logo 下方的分隔線**：
   - 跟隨 Logo 區塊
   - 目的：區隔商家識別和優惠內容

3. **沒有 Logo 時**：
   ```
   [查看地圖]
   ─────────── (直接進入優惠)
   商家優惠...
   ```

## 🔍 條件邏輯

### Logo + 店名區塊顯示條件

```typescript
isStore && data.storeLogo;
```

- 必須是商家（`isAD = true`）
- 必須有 Logo 圖片

### 商家優惠區塊顯示條件

```typescript
data.isAD && (data.activityTitle || data.websiteLink);
```

- 必須是商家
- 至少有活動標題或官網連結之一

### 完整判斷流程

```
1. 是否顯示 Hero？
   → isAD && imageLink

2. 是否顯示 Logo + 店名？
   → isAD && storeLogo

3. 是否顯示商家優惠？
   → isAD && (activityTitle || websiteLink)

4. 是否顯示店家資訊按鈕？
   → websiteLink 存在
```

## 📊 所有可能的組合

### 組合 1：Banner + Logo + 優惠（完整版）

```
[Banner] ← Hero
已通過...
─────────
詳細資訊
[查看地圖]
─────────
[Logo] 店名
─────────
優惠內容
[店家資訊] 灰框
```

### 組合 2：只有 Logo + 優惠

```
已通過...
─────────
詳細資訊
[查看地圖]
─────────
[Logo] 店名
─────────
優惠內容
[店家資訊] 灰框
```

### 組合 3：只有 Banner + 優惠（無 Logo）

```
[Banner]
已通過...
─────────
詳細資訊
[查看地圖]
─────────
優惠內容
[店家資訊] 灰框
```

### 組合 4：只有 Banner（無優惠）

```
[Banner]
已通過...
─────────
詳細資訊
[查看地圖]
```

### 組合 5：一般 Gateway

```
已通過...
─────────
詳細資訊
[查看地圖]
```

## 🎯 設計優勢

### 1. 結構清晰

```
內容區（Body）：通知資訊
  ↓
操作區（Footer）：用戶操作
  ↓
  主操作：查看地圖
  ↓
  商家識別：Logo + 店名
  ↓
  附加價值：商家優惠
  ↓
  次操作：店家資訊
```

### 2. 視覺層級

- 最重要：通知主旨（已通過）
- 重要：查看地圖按鈕
- 次要：商家識別
- 附加：商家優惠
- 輔助：店家資訊按鈕

### 3. 操作流程

```
用戶收到通知
  ↓
看到 Banner（如有）→ 吸引注意
  ↓
閱讀「已通過」→ 了解主旨
  ↓
查看詳細資訊 → 確認細節
  ↓
決策：
  選項 1: [查看地圖] → 確認位置
  選項 2: 看到 Logo + 優惠 → 了解商家
  選項 3: [店家資訊] → 深入了解
```

## 📏 技術規範

### Hero Image

- **來源**：`data.imageLink`
- **比例**：3:1
- **裁切**：cover

### Logo Image（Footer 中）

- **來源**：`data.storeLogo`
- **尺寸**：xs（約 48px）
- **比例**：1:1
- **裁切**：cover
- **位置**：水平排列左側

### 主按鈕

```typescript
style: "primary";
color: "#4ECDC4";
label: "查看地圖";
```

### 次按鈕

```typescript
style: "secondary"; // ← 有灰色邊框
color: "#999999"; // ← 灰色
label: "店家資訊"; // ← 無 emoji
```

## 🔄 修改歷史

### Version 1（初版）

```
[Logo 1:1] Hero
已通過 location
─────────
設備、地點、時間
[查看地圖]
優惠...
🔗 前往官網
```

### Version 2（第一次調整）

```
[Banner 3:1] Hero
[Logo] location (在 Body)
─────────
設備、地點、時間
[查看地圖]
優惠...
店家資訊 (透明)
```

### Version 3（最終版）✅

```
[Banner 3:1] Hero
已通過 location
─────────
設備、地點、時間
[查看地圖]
─────────
[Logo] 店名 (在 Footer)
─────────
優惠...
[店家資訊] (灰框)    ← 有邊框
```

## ✨ 最終改進

### 1. Logo 位置

- ❌ 在 Body 中（與詳細資訊混在一起）
- ✅ 在 Footer 中，查看地圖之後（獨立區塊）

### 2. 店家資訊按鈕

- ❌ 透明背景（不夠明顯）
- ✅ 灰色邊框（有存在感但不搶主按鈕）

### 3. 結構邏輯

- ✅ Body：純資訊（通知內容 + 詳細資訊）
- ✅ Footer：操作 + 商家內容（操作按鈕 + 商家識別 + 優惠）

## 📝 修改檔案

1. ✅ `functions/src/line/sendMessage.ts`
   - 調整 Footer 結構
   - Logo + 店名移到查看地圖後
   - 店家資訊按鈕改為 secondary style

## ✅ 檢查清單

- [✅] Hero: Banner 3:1
- [✅] Body: 已通過 location
- [✅] Body: 分隔線
- [✅] Body: 詳細資訊
- [✅] Footer: 查看地圖按鈕
- [✅] Footer: 分隔線（商家有Logo時）
- [✅] Footer: Logo + 店名（商家有Logo時）
- [✅] Footer: 分隔線（商家有優惠時）
- [✅] Footer: 商家優惠區塊
- [✅] Footer: 店家資訊按鈕（secondary，灰框）
- [✅] Footer: 底部提示
- [✅] TypeScript 編譯通過
- [✅] Functions Build 成功

## 🚀 部署

```bash
cd functions
firebase deploy --only functions:receiveBeaconData
```

## 🎉 最終效果

LINE 通知訊息現在：

- ✅ Hero 顯示 3:1 Banner（醒目）
- ✅ 清晰的通知主旨（已通過）
- ✅ Logo + 店名在操作區（獨立識別）
- ✅ 店家資訊按鈕有灰色邊框（明顯但不搶眼）
- ✅ 結構邏輯清晰（內容 → 操作 → 商家 → 優惠）

準備部署！🚀

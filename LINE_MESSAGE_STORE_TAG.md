# LINE 通知訊息 - 守護合作商家標記

## 📋 更新內容

當通過的是商家（`isAD = true`）時，在通知主旨中加入「守護合作商家」文案。

## 🔄 文案對比

### 一般 Gateway

```
小明的手環 已經過
大安森林公園
```

### 商家 Gateway

```
小明的手環 已經過 守護合作商家
星巴克信義店
```

## 💻 代碼實現

```typescript
{
  type: "text",
  text: isStore
    ? `${deviceName} 已經過 守護合作商家`
    : `${deviceName} 已經過`,
  weight: "bold",
  size: "md",
  wrap: true
}
```

### 判斷邏輯

```typescript
const isStore = data.isAD === true;

if (isStore) {
  text = "{設備名稱} 已經過 守護合作商家";
} else {
  text = "{設備名稱} 已經過";
}
```

## 📱 完整訊息範例

### 商家完整版

```
┌─────────────────────────────────────┐
│  ┌────────────────────────────┐    │
│  │    [Banner 圖片 3:1]       │    │
│  └────────────────────────────┘    │
├─────────────────────────────────────┤
│  小明的手環 已經過 守護合作商家     │  ← 新增文案
│  星巴克信義店                       │
│  ───────────────────                │
│  設備：小明的手環                   │
│  地點：星巴克信義店                 │
│  時間：2026/01/29 14:30            │
├─────────────────────────────────────┤
│  ┌──────────────────────────┐      │
│  │        查看地圖          │      │
│  └──────────────────────────┘      │
│  ───────────────────                │
│  商家優惠                           │
│  春節特惠活動                       │
│  全店商品 8 折優惠...              │
│  ┌──────────────────────────┐      │
│  │      店家資訊            │      │
│  └──────────────────────────┘      │
│  此通知由您設定的通知點自動發送     │
└─────────────────────────────────────┘
```

### 一般 Gateway

```
┌─────────────────────────────────────┐
│  小明的手環 已經過                  │  ← 無「守護合作商家」
│  大安森林公園                       │
│  ───────────────────                │
│  設備：小明的手環                   │
│  地點：大安森林公園                 │
│  時間：2026/01/29 14:30            │
├─────────────────────────────────────┤
│  ┌──────────────────────────┐      │
│  │        查看地圖          │      │
│  └──────────────────────────┘      │
│  此通知由您設定的通知點自動發送     │
└─────────────────────────────────────┘
```

## 🎯 設計理念

### 1. 強調商家合作關係

- 「守護合作商家」突顯平台與商家的合作關係
- 增加用戶對商家的信任感
- 強化品牌形象

### 2. 區分商家與一般地點

- 商家：「已經過 守護合作商家」
- 一般：「已經過」
- 用戶一眼就能分辨

### 3. 提升商家價值

- 商家不只是「通知點」
- 是「守護合作商家」（更有意義）
- 增加商家的榮譽感

## 📊 不同情境

### 情境 A：經過星巴克

```
小明的手環 已經過 守護合作商家
星巴克信義店
```

**感覺**：這是一個合作的商家，值得信賴

### 情境 B：經過 7-11

```
小明的手環 已經過 守護合作商家
7-11光復門市
```

**感覺**：這是一個合作的便利商店

### 情境 C：經過公園

```
小明的手環 已經過
大安森林公園
```

**感覺**：這是一般的通知點

## 🎨 文案設計

### 「守護合作商家」的含義

**守護**：

- 表達關懷和保護
- 與安全守護的品牌主題一致
- 溫暖、正面的情感

**合作商家**：

- 明確是商家
- 強調合作關係
- 建立信任感

### 替代文案（參考）

- ✅ 守護合作商家（採用）
- 合作友善商家
- 認證合作商家
- 平台合作商家

## 📝 修改檔案

1. ✅ `functions/src/line/sendMessage.ts`
   - 修改通知主旨文案
   - 根據 `isAD` 條件顯示不同文字

## ✅ 檢查清單

- [✅] 商家顯示「守護合作商家」
- [✅] 一般 Gateway 不顯示
- [✅] 文案自然流暢
- [✅] TypeScript 編譯通過
- [✅] Functions Build 成功

## 🚀 部署

```bash
cd functions
firebase deploy --only functions:receiveBeaconData
```

## 🎉 最終效果

現在 LINE 通知訊息：

- ✅ 商家：「已經過 守護合作商家」
- ✅ 一般：「已經過」
- ✅ 店家資訊按鈕：白底灰框
- ✅ 商家優惠間距：舒適的 lg
- ✅ 結構簡潔清晰

準備部署！🚀

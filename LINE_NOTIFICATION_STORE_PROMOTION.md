# LINE é€šçŸ¥è¨Šæ¯ - å•†å®¶å„ªæƒ é¡¯ç¤º

## ğŸ“‹ æ›´æ–°å…§å®¹

ç•¶ BU_type = "safe" çš„ LINE é€šçŸ¥ä¸­ï¼Œå¦‚æœé€šéçš„ Gateway æ˜¯å•†å®¶ï¼ˆ`isAD = true`ï¼‰ï¼Œå‰‡åœ¨é€šçŸ¥è¨Šæ¯ä¸­é¡¯ç¤ºå•†å®¶å„ªæƒ è³‡è¨Šã€‚

## ğŸ¯ è§¸ç™¼æ¢ä»¶

### åŸºæœ¬æ¢ä»¶ï¼ˆå¿…é ˆæ»¿è¶³ï¼‰

1. `device.bindingType === "LINE_USER"`
2. `tenant.BU_type === "safe"`
3. Gateway åœ¨ç”¨æˆ¶çš„ `inheritedNotificationPointIds` ä¸­

### å•†å®¶å„ªæƒ é¡¯ç¤ºæ¢ä»¶ï¼ˆé¡å¤–ï¼‰

4. `gateway.isAD === true`ï¼ˆæ˜¯å•†å®¶ï¼‰
5. ä»¥ä¸‹è‡³å°‘æœ‰ä¸€é …ï¼š
   - `storeLogo` æœ‰å€¼ï¼ˆé¡¯ç¤ºåœ¨ headerï¼‰
   - `activityTitle` æœ‰å€¼
   - `imageLink` æœ‰å€¼
   - `websiteLink` æœ‰å€¼

## ğŸ“± è¨Šæ¯çµæ§‹

### A. ä¸€èˆ¬ Gateway è¨Šæ¯ï¼ˆåŸæœ‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚  æ‚¨çš„è¨­å‚™ å·²ç¶“é                â”‚
â”‚  æ˜Ÿå·´å…‹ä¿¡ç¾©åº—                   â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚                                 â”‚
â”‚  è¨­å‚™ï¼šæ‚¨çš„è¨­å‚™                 â”‚
â”‚  åœ°é»ï¼šæ˜Ÿå·´å…‹ä¿¡ç¾©åº—             â”‚
â”‚  æ™‚é–“ï¼š2026/01/29 14:30        â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  æŸ¥çœ‹åœ°åœ–    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â”‚  æ­¤é€šçŸ¥ç”±æ‚¨è¨­å®šçš„é€šçŸ¥é»è‡ªå‹•ç™¼é€ â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### B. å•†å®¶å„ªæƒ è¨Šæ¯ï¼ˆæ–°å¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        â”‚    â”‚
â”‚  â”‚    [åº—å®¶ Logo åœ–ç‰‡]    â”‚    â”‚  â† 1:1 Hero Image
â”‚  â”‚                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  æ‚¨çš„è¨­å‚™ å·²ç¶“é                â”‚
â”‚  æ˜Ÿå·´å…‹ä¿¡ç¾©åº—                   â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚                                 â”‚
â”‚  è¨­å‚™ï¼šæ‚¨çš„è¨­å‚™                 â”‚
â”‚  åœ°é»ï¼šæ˜Ÿå·´å…‹ä¿¡ç¾©åº—             â”‚
â”‚  æ™‚é–“ï¼š2026/01/29 14:30        â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  æŸ¥çœ‹åœ°åœ–    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚  â† åˆ†éš”ç·š
â”‚                                 â”‚
â”‚  å•†å®¶å„ªæƒ                        â”‚  â† å°æ¨™é¡Œ
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  [Banner åœ–ç‰‡ 3:1]     â”‚    â”‚  â† å„ªæƒ åœ–ç‰‡
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚
â”‚  æ˜¥ç¯€ç‰¹æƒ æ´»å‹•                   â”‚  â† å„ªæƒ æ¨™é¡Œï¼ˆç²—é«”ï¼‰
â”‚                                 â”‚
â”‚  å…¨åº—å•†å“ 8 æŠ˜å„ªæƒ               â”‚  â† å„ªæƒ å…§å®¹
â”‚  å‡¡è³¼è²·æ»¿ $1000 å…ƒ              â”‚
â”‚  å³å¯ç²å¾—ç²¾ç¾ç¦®å“ä¸€ä»½           â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ğŸ”— å‰å¾€å®˜ç¶²   â”‚              â”‚  â† å®˜ç¶²æŒ‰éˆ•ï¼ˆå¦‚æœ‰ï¼‰
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â”‚  æ­¤é€šçŸ¥ç”±æ‚¨è¨­å®šçš„é€šçŸ¥é»è‡ªå‹•ç™¼é€ â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» ä»£ç¢¼å¯¦ç¾

### 1. Hero Imageï¼ˆåº—å®¶ Logoï¼‰

åªæœ‰ç•¶ `isAD && storeLogo` æ™‚æ‰æ·»åŠ ï¼š

```typescript
const isStore = data.isAD && data.storeLogo;

{
  type: "bubble",
  ...(isStore && data.storeLogo
    ? {
        hero: {
          type: "image",
          url: data.storeLogo,
          size: "full",
          aspectRatio: "1:1",  // æ­£æ–¹å½¢
          aspectMode: "cover",  // å¡«æ»¿ä¸¦è£åˆ‡
        },
      }
    : {}),
  body: { ... }
}
```

### 2. Footer å•†å®¶å„ªæƒ å€å¡Š

åœ¨ã€ŒæŸ¥çœ‹åœ°åœ–ã€æŒ‰éˆ•å¾Œæ·»åŠ å•†å®¶å„ªæƒ å…§å®¹ï¼š

```typescript
footer: {
  contents: [
    {
      type: "button",
      label: "æŸ¥çœ‹åœ°åœ–",
      ...
    },
    // å•†å®¶å„ªæƒ å€å¡Š
    ...(data.isAD && (data.activityTitle || data.imageLink || data.websiteLink)
      ? [
          { type: "separator", margin: "lg" },  // åˆ†éš”ç·š
          {
            type: "box",
            contents: [
              // å°æ¨™é¡Œ
              { type: "text", text: "å•†å®¶å„ªæƒ ", ... },

              // Banner åœ–ç‰‡ï¼ˆå¦‚æœ‰ï¼‰
              ...(data.imageLink ? [{
                type: "image",
                url: data.imageLink,
                aspectRatio: "3:1",  // 3:1 æ¯”ä¾‹
                aspectMode: "cover",
              }] : []),

              // å„ªæƒ æ¨™é¡Œï¼ˆå¦‚æœ‰ï¼‰
              ...(data.activityTitle ? [{
                type: "text",
                text: data.activityTitle,
                weight: "bold",
              }] : []),

              // å„ªæƒ å…§å®¹ï¼ˆå¦‚æœ‰ï¼‰
              ...(data.activityContent ? [{
                type: "text",
                text: data.activityContent,
                wrap: true,
              }] : []),

              // å®˜ç¶²é€£çµï¼ˆå¦‚æœ‰ï¼‰
              ...(data.websiteLink ? [{
                type: "button",
                label: "ğŸ”— å‰å¾€å®˜ç¶²",
                action: { type: "uri", uri: data.websiteLink }
              }] : []),
            ]
          }
        ]
      : []),
    {
      type: "text",
      text: "æ­¤é€šçŸ¥ç”±æ‚¨è¨­å®šçš„é€šçŸ¥é»è‡ªå‹•ç™¼é€",
      ...
    }
  ]
}
```

### 3. æ•¸æ“šå‚³é

åœ¨ `receiveBeaconData.ts` ä¸­å‚³éå•†å®¶è³‡è¨Šï¼š

```typescript
await sendNotificationPointAlert(lineUserId, channelAccessToken, {
  gatewayName: gateway.name || "é€šçŸ¥é»",
  deviceNickname: deviceData?.mapUserNickname || undefined,
  latitude: lat,
  longitude: lng,
  timestamp: new Date(timestamp).toISOString(),
  // å•†å®¶ç›¸é—œè³‡è¨Š
  isAD: gateway.isAD,
  storeLogo: gateway.storeLogo,
  imageLink: gateway.imageLink,
  activityTitle: gateway.activityTitle,
  activityContent: gateway.activityContent,
  websiteLink: gateway.websiteLink,
});
```

## ğŸ“Š ä¸åŒæƒ…å¢ƒçš„è¨Šæ¯é¡¯ç¤º

### æƒ…å¢ƒ Aï¼šå®Œæ•´å•†å®¶è³‡è¨Š

```javascript
Gateway:
{
  isAD: true,
  storeLogo: "https://.../logo.png",
  imageLink: "https://.../banner.jpg",
  activityTitle: "æ˜¥ç¯€ç‰¹æƒ æ´»å‹•",
  activityContent: "å…¨åº—å•†å“ 8 æŠ˜å„ªæƒ ...",
  websiteLink: "https://..."
}

LINE è¨Šæ¯ï¼š
âœ… Hero: åº—å®¶ Logo
âœ… Body: åŸºæœ¬è³‡è¨Š
âœ… æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
âœ… åˆ†éš”ç·š
âœ… å•†å®¶å„ªæƒ ï¼š
   - Banner åœ–ç‰‡
   - å„ªæƒ æ¨™é¡Œ
   - å„ªæƒ å…§å®¹
   - å®˜ç¶²æŒ‰éˆ•
âœ… åº•éƒ¨æç¤º
```

### æƒ…å¢ƒ Bï¼šå•†å®¶ä½†ç„¡ Logo

```javascript
Gateway:
{
  isAD: true,
  storeLogo: null,  // ç„¡ Logo
  activityTitle: "æ˜¥ç¯€ç‰¹æƒ æ´»å‹•",
  ...
}

LINE è¨Šæ¯ï¼š
âŒ Hero: ç„¡
âœ… Body: åŸºæœ¬è³‡è¨Š
âœ… æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
âœ… å•†å®¶å„ªæƒ å€å¡Š
âœ… åº•éƒ¨æç¤º
```

### æƒ…å¢ƒ Cï¼šå•†å®¶ä½†ç„¡å„ªæƒ æ´»å‹•

```javascript
Gateway:
{
  isAD: true,
  storeLogo: "https://.../logo.png",
  activityTitle: null,  // ç„¡å„ªæƒ 
  imageLink: null,
  websiteLink: null
}

LINE è¨Šæ¯ï¼š
âœ… Hero: åº—å®¶ Logo
âœ… Body: åŸºæœ¬è³‡è¨Š
âœ… æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
âŒ å•†å®¶å„ªæƒ å€å¡Šï¼ˆä¸é¡¯ç¤ºï¼Œå› ç‚ºæ²’æœ‰å…§å®¹ï¼‰
âœ… åº•éƒ¨æç¤º
```

### æƒ…å¢ƒ Dï¼šä¸€èˆ¬ Gateway

```javascript
Gateway:
{
  isAD: false,
  type: "SAFE_ZONE",
  ...
}

LINE è¨Šæ¯ï¼š
âŒ Hero: ç„¡
âœ… Body: åŸºæœ¬è³‡è¨Š
âœ… æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
âŒ å•†å®¶å„ªæƒ å€å¡Šï¼ˆä¸é¡¯ç¤ºï¼‰
âœ… åº•éƒ¨æç¤º
```

## ğŸ¨ è¨­è¨ˆè¦ç¯„

### Hero Imageï¼ˆåº—å®¶ Logoï¼‰

```typescript
{
  type: "image",
  url: data.storeLogo,
  size: "full",          // å¡«æ»¿å¯¬åº¦
  aspectRatio: "1:1",    // æ­£æ–¹å½¢
  aspectMode: "cover",   // è£åˆ‡å¡«æ»¿
}
```

### Banner Imageï¼ˆå„ªæƒ åœ–ç‰‡ï¼‰

```typescript
{
  type: "image",
  url: data.imageLink,
  size: "full",          // å¡«æ»¿å¯¬åº¦
  aspectRatio: "3:1",    // æ©«å‘çŸ©å½¢
  aspectMode: "cover",   // è£åˆ‡å¡«æ»¿
}
```

### æ–‡å­—æ¨£å¼

| å…ƒç´          | å¤§å° | å­—é‡   | é¡è‰²    |
| ------------ | ---- | ------ | ------- |
| å•†å®¶å„ªæƒ æ¨™é¡Œ | sm   | bold   | #666666 |
| å„ªæƒ æ´»å‹•æ¨™é¡Œ | md   | bold   | é è¨­    |
| å„ªæƒ æ´»å‹•å…§å®¹ | sm   | normal | #666666 |

## ğŸ“ åœ–ç‰‡æ¯”ä¾‹

### storeLogoï¼ˆHeroï¼‰

- **æ¯”ä¾‹**ï¼š1:1ï¼ˆæ­£æ–¹å½¢ï¼‰
- **å»ºè­°å°ºå¯¸**ï¼š400x400 æˆ–æ›´é«˜
- **é¡¯ç¤ºæ–¹å¼**ï¼šå¡«æ»¿å¯¬åº¦ï¼Œè‡ªå‹•è£åˆ‡

### imageLinkï¼ˆBannerï¼‰

- **æ¯”ä¾‹**ï¼š3:1ï¼ˆæ©«å‘ï¼‰
- **å»ºè­°å°ºå¯¸**ï¼š1200x400 æˆ–æ›´é«˜
- **é¡¯ç¤ºæ–¹å¼**ï¼šå¡«æ»¿å¯¬åº¦ï¼Œè‡ªå‹•è£åˆ‡

## ğŸ”„ èˆ‡åœ°åœ–å½ˆçª—çš„ä¸€è‡´æ€§

### åœ°åœ–å½ˆçª—

```
ğŸª é ­åƒï¼ˆ48x48ï¼Œæ¨™é¡Œæ—ï¼‰
[â­ åˆä½œå‹å–„å•†å®¶]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•†å®¶å„ªæƒ 
[Banner 3:1]
å„ªæƒ æ¨™é¡Œ
å„ªæƒ å…§å®¹
ğŸ”— å‰å¾€å®˜ç¶²
```

### LINE è¨Šæ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logo 1:1     â”‚  â† Hero Image
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
åŸºæœ¬è³‡è¨Š
[æŸ¥çœ‹åœ°åœ–]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•†å®¶å„ªæƒ 
[Banner 3:1]
å„ªæƒ æ¨™é¡Œ
å„ªæƒ å…§å®¹
ğŸ”— å‰å¾€å®˜ç¶²
```

**å…±åŒé»**ï¼š

- âœ… éƒ½æœ‰åº—å®¶ Logo
- âœ… éƒ½æœ‰å•†å®¶å„ªæƒ å€å¡Š
- âœ… Banner éƒ½æ˜¯ 3:1 æ¯”ä¾‹
- âœ… å…§å®¹çµæ§‹ä¸€è‡´

**å·®ç•°é»**ï¼š

- åœ°åœ–ï¼šLogo 48x48 åœ“å½¢ï¼Œåœ¨æ¨™é¡Œæ—
- LINEï¼šLogo å…¨å¯¬ Hero Imageï¼Œåœ¨æœ€ä¸Šæ–¹

## ğŸ“ ä¿®æ”¹çš„æª”æ¡ˆ

### 1. functions/src/line/sendMessage.ts

- âœ… æ›´æ–° `NotificationPointData` interface
- âœ… ä¿®æ”¹ `sendNotificationPointAlert` å‡½æ•¸
- âœ… æ·»åŠ  Hero Imageï¼ˆstoreLogoï¼‰
- âœ… æ·»åŠ å•†å®¶å„ªæƒ å€å¡Š

### 2. functions/src/beacon/receiveBeaconData.ts

- âœ… å‚³éå•†å®¶ç›¸é—œè³‡è¨Šåˆ°é€šçŸ¥å‡½æ•¸

## ğŸ§ª æ¸¬è©¦æ¡ˆä¾‹

### æ¸¬è©¦ 1ï¼šå®Œæ•´å•†å®¶å„ªæƒ 

```
Gateway è³‡æ–™ï¼š
{
  isAD: true,
  storeLogo: "https://example.com/logo.png",
  imageLink: "https://example.com/banner.jpg",
  activityTitle: "æ˜¥ç¯€ç‰¹æƒ æ´»å‹•",
  activityContent: "å…¨åº—å•†å“ 8 æŠ˜å„ªæƒ \næ»¿åƒé€ç™¾",
  websiteLink: "https://example.com"
}

é æœŸ LINE è¨Šæ¯ï¼š
âœ… Hero: Logo åœ–ç‰‡
âœ… Body: åŸºæœ¬é€šçŸ¥è³‡è¨Š
âœ… Button: æŸ¥çœ‹åœ°åœ–
âœ… Separator: åˆ†éš”ç·š
âœ… å•†å®¶å„ªæƒ ï¼š
   - å°æ¨™é¡Œã€Œå•†å®¶å„ªæƒ ã€
   - Banner åœ–ç‰‡ï¼ˆ3:1ï¼‰
   - å„ªæƒ æ¨™é¡Œ
   - å„ªæƒ å…§å®¹ï¼ˆå¤šè¡Œï¼‰
   - å®˜ç¶²æŒ‰éˆ•
âœ… Footer: æç¤ºæ–‡å­—
```

### æ¸¬è©¦ 2ï¼šåªæœ‰æ¨™é¡Œå’Œå…§å®¹

```
Gateway è³‡æ–™ï¼š
{
  isAD: true,
  storeLogo: null,
  imageLink: null,
  activityTitle: "é™æ™‚å„ªæƒ ",
  activityContent: "æœ¬é€±ç‰¹åƒ¹å•†å“...",
  websiteLink: null
}

é æœŸ LINE è¨Šæ¯ï¼š
âŒ Hero: ç„¡
âœ… Body: åŸºæœ¬é€šçŸ¥è³‡è¨Š
âœ… Button: æŸ¥çœ‹åœ°åœ–
âœ… å•†å®¶å„ªæƒ ï¼š
   - å°æ¨™é¡Œã€Œå•†å®¶å„ªæƒ ã€
   - å„ªæƒ æ¨™é¡Œ
   - å„ªæƒ å…§å®¹
âŒ Banner åœ–ç‰‡: ç„¡
âŒ å®˜ç¶²æŒ‰éˆ•: ç„¡
```

### æ¸¬è©¦ 3ï¼šåªæœ‰ Logo

```
Gateway è³‡æ–™ï¼š
{
  isAD: true,
  storeLogo: "https://example.com/logo.png",
  imageLink: null,
  activityTitle: null,
  activityContent: null,
  websiteLink: null
}

é æœŸ LINE è¨Šæ¯ï¼š
âœ… Hero: Logo åœ–ç‰‡
âœ… Body: åŸºæœ¬é€šçŸ¥è³‡è¨Š
âœ… Button: æŸ¥çœ‹åœ°åœ–
âŒ å•†å®¶å„ªæƒ å€å¡Š: ç„¡ï¼ˆæ²’æœ‰å„ªæƒ å…§å®¹ï¼‰
```

### æ¸¬è©¦ 4ï¼šä¸€èˆ¬ Gateway

```
Gateway è³‡æ–™ï¼š
{
  isAD: false,
  type: "SAFE_ZONE",
  ...
}

é æœŸ LINE è¨Šæ¯ï¼š
âŒ Hero: ç„¡
âœ… Body: åŸºæœ¬é€šçŸ¥è³‡è¨Š
âœ… Button: æŸ¥çœ‹åœ°åœ–
âŒ å•†å®¶å„ªæƒ å€å¡Š: ç„¡
```

## ğŸ¨ Flex Message çµæ§‹è©³è§£

### Hero å€å¡Šï¼ˆå¯é¸ï¼‰

```typescript
hero: {
  type: "image",
  url: data.storeLogo,
  size: "full",
  aspectRatio: "1:1",
  aspectMode: "cover",
}
```

### Body å€å¡Šï¼ˆå¿…é ˆï¼‰

```typescript
body: {
  type: "box",
  layout: "vertical",
  contents: [
    { type: "text", text: `${deviceName} å·²ç¶“é`, ... },
    { type: "text", text: data.gatewayName, ... },
    { type: "separator", ... },
    // è©³ç´°è³‡è¨Šï¼ˆè¨­å‚™ã€åœ°é»ã€æ™‚é–“ï¼‰
  ]
}
```

### Footer å€å¡Šï¼ˆå¿…é ˆï¼‰

```typescript
footer: {
  type: "box",
  layout: "vertical",
  spacing: "sm",
  contents: [
    // 1. æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
    { type: "button", label: "æŸ¥çœ‹åœ°åœ–", ... },

    // 2. å•†å®¶å„ªæƒ å€å¡Šï¼ˆæ¢ä»¶é¡¯ç¤ºï¼‰
    ...(hasPromotion ? [
      { type: "separator" },
      {
        type: "box",
        contents: [
          { type: "text", text: "å•†å®¶å„ªæƒ " },
          ...(imageLink ? [{ type: "image", ... }] : []),
          ...(activityTitle ? [{ type: "text", ... }] : []),
          ...(activityContent ? [{ type: "text", ... }] : []),
          ...(websiteLink ? [{ type: "button", ... }] : []),
        ]
      }
    ] : []),

    // 3. åº•éƒ¨æç¤º
    { type: "text", text: "æ­¤é€šçŸ¥ç”±æ‚¨è¨­å®šçš„é€šçŸ¥é»è‡ªå‹•ç™¼é€" }
  ]
}
```

## ğŸ“Š æ•¸æ“šæµå‘

```
Gateway (Firestore)
  â†“ (åŒ…å«å•†å®¶è³‡è¨Š)
receiveBeaconData.ts
  â†“ (å‚³éçµ¦é€šçŸ¥å‡½æ•¸)
sendNotificationPointAlert()
  â†“ (æ§‹å»º Flex Message)
LINE Messaging API
  â†“
ç”¨æˆ¶çš„ LINE
```

## ğŸ¯ å•†æ¥­åƒ¹å€¼

### 1. æå‡å•†å®¶æ›å…‰

- é€šçŸ¥è¨Šæ¯ä¸­ç›´æ¥é¡¯ç¤ºå„ªæƒ 
- ä¸éœ€è¦é¡å¤–æ“ä½œå°±èƒ½çœ‹åˆ°å„ªæƒ è³‡è¨Š

### 2. å¢åŠ è½‰æ›ç‡

- ç”¨æˆ¶ç¶“éå•†å®¶æ™‚æ”¶åˆ°é€šçŸ¥
- ç«‹å³çœ‹åˆ°å„ªæƒ å…§å®¹
- å¯ä»¥ç›´æ¥é»æ“Šå®˜ç¶²äº†è§£æ›´å¤š

### 3. æ”¹å–„é«”é©—

- è¨Šæ¯æ›´è±å¯Œã€æ›´æœ‰åƒ¹å€¼
- ä¸åªæ˜¯ã€Œç¶“éé€šçŸ¥ã€ï¼Œé‚„æœ‰å¯¦éš›å„ªæƒ è³‡è¨Š
- æå‡ç”¨æˆ¶å°é€šçŸ¥çš„æœŸå¾…

## âš ï¸ æ³¨æ„äº‹é …

### 1. åœ–ç‰‡å¤§å°

- Hero Imageï¼ˆLogoï¼‰ï¼šå»ºè­° < 1MB
- Banner Imageï¼šå»ºè­° < 1MB
- LINE æœ‰åœ–ç‰‡å¤§å°é™åˆ¶

### 2. åœ–ç‰‡ URL

- å¿…é ˆæ˜¯å…¬é–‹å¯è¨ªå•çš„ HTTPS URL
- Firebase Storage çš„åœ–ç‰‡ URL ç¬¦åˆè¦æ±‚
- ç¢ºä¿ CORS å’Œæ¬Šé™è¨­å®šæ­£ç¢º

### 3. æ–‡å­—é•·åº¦

- å„ªæƒ å…§å®¹å»ºè­° < 500 å­—
- éé•·çš„æ–‡å­—å¯èƒ½å½±éŸ¿é–±è®€é«”é©—
- ä½¿ç”¨æ›è¡Œç¬¦è™Ÿï¼ˆ\nï¼‰åˆ†æ®µ

### 4. æŒ‰éˆ•æ•¸é‡

LINE Flex Message é™åˆ¶ï¼š

- æ¯å€‹å€å¡Šæœ€å¤š 5 å€‹ action
- ç›®å‰æœ‰ï¼šæŸ¥çœ‹åœ°åœ– + å‰å¾€å®˜ç¶² = 2 å€‹ï¼ˆå®‰å…¨ï¼‰

## ğŸ” èª¿è©¦æ–¹æ³•

### æŸ¥çœ‹ç™¼é€çš„è¨Šæ¯

```bash
firebase functions:log --only receiveBeaconData
```

é—œéµæ—¥èªŒï¼š

```
Safe mode: checking notification points
âœ“ Sent LINE notification to Uxxx via tenant yyy (BU_type=safe)
```

### æ¸¬è©¦è¨Šæ¯æ ¼å¼

ä½¿ç”¨ LINE Flex Message Simulatorï¼š
https://developers.line.biz/flex-simulator/

## ğŸ’¡ æœªä¾†å„ªåŒ–å»ºè­°

### 1. å€‹æ€§åŒ–å…§å®¹

```typescript
const message = `${deviceName} å·²åˆ°é” ${gatewayName}ï¼Œ
æœ‰å°ˆå±¬å„ªæƒ ç­‰æ‚¨é ˜å–ï¼`;
```

### 2. é™æ™‚å„ªæƒ æ¨™è¨˜

```typescript
if (isLimitedTime) {
  addBadge("é™æ™‚å„ªæƒ ");
}
```

### 3. å„ªæƒ åˆ¸åŠŸèƒ½

```typescript
{
  type: "button",
  label: "é ˜å–å„ªæƒ åˆ¸",
  action: {
    type: "uri",
    uri: `https://liff.line.me/.../coupon?store=${gateway.id}`
  }
}
```

### 4. ä½¿ç”¨çµ±è¨ˆ

è¿½è¹¤ï¼š

- å®˜ç¶²é€£çµé»æ“Šç‡
- å„ªæƒ è¨Šæ¯é–‹å•Ÿç‡
- è½‰æ›æ•ˆæœ

## âœ… æª¢æŸ¥æ¸…å–®

- [âœ…] æ›´æ–° NotificationPointData interface
- [âœ…] ä¿®æ”¹ sendNotificationPointAlert å‡½æ•¸
- [âœ…] æ·»åŠ  Hero Image é‚è¼¯
- [âœ…] æ·»åŠ å•†å®¶å„ªæƒ å€å¡Š
- [âœ…] æ¢ä»¶æ¸²æŸ“ï¼ˆåªåœ¨æœ‰å…§å®¹æ™‚é¡¯ç¤ºï¼‰
- [âœ…] æ›´æ–°æ•¸æ“šå‚³é
- [âœ…] TypeScript ç·¨è­¯é€šé
- [â³] Functions ç·¨è­¯æ¸¬è©¦ï¼ˆé€²è¡Œä¸­ï¼‰
- [â³] å¯¦éš›é€šçŸ¥æ¸¬è©¦ï¼ˆå¾…æ¸¬è©¦ï¼‰

## ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é …

1. **Functions éƒ¨ç½²**

   ```bash
   firebase deploy --only functions:receiveBeaconData
   ```

2. **æ¸¬è©¦æµç¨‹**
   - è¨­å®šä¸€å€‹æ¸¬è©¦å•†å®¶
   - è¨­å®šé€šçŸ¥é»
   - å¯¦éš›è§¸ç™¼é€šçŸ¥
   - æª¢æŸ¥ LINE è¨Šæ¯æ ¼å¼

3. **ç›£æ§**
   - æŸ¥çœ‹ Functions æ—¥èªŒ
   - ç¢ºèªè¨Šæ¯ç™¼é€æˆåŠŸ
   - æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤

ç¾åœ¨ LINE é€šçŸ¥æœƒé¡¯ç¤ºå®Œæ•´çš„å•†å®¶å„ªæƒ è³‡è¨Šäº†ï¼ğŸ‰

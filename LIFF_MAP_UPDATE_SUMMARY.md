# LIFF 地圖商家功能更新總結

## 📋 更新內容

### 1. ⭐ 新增「合作友善商家」標籤

- **觸發條件**：`gateway.isAD === true`
- **顯示位置**：Type Badge 旁邊
- **樣式設計**：
  - 背景色：`#dcfce7`（淡綠色）
  - 文字色：`#16a34a`（深綠色）
  - 邊框：`1px solid #86efac`（中綠色）
  - 圖示：⭐ 星星圖標
  - 文字：「合作友善商家」

### 2. 📍 序號顯示位置調整

- **原位置**：彈窗標題旁的 Badge
- **新位置**：內容區域最後（操作按鈕上方）
- **樣式變更**：
  - 字體大小：12px（小字）
  - 顏色：`#9ca3af`（灰色）
  - 對齊：置中
  - 上方：分隔線
  - 格式：「接收點序號：g-26-01-0001」

## 🎨 視覺對比

### 修改前

```
┌──────────────────────────────────┐
│ 📍 接收點詳情  [序號: g-26-01]  │  ← 序號在標題旁
├──────────────────────────────────┤
│ 🏪 📍 店家名稱                   │
│ [🏠 安全區域]                    │  ← 只有 Type Badge
│ ...                              │
│ [操作按鈕]                       │
└──────────────────────────────────┘
```

### 修改後

```
┌──────────────────────────────────┐
│ 📍 接收點詳情                    │  ← 標題簡潔
├──────────────────────────────────┤
│ 🏪 📍 店家名稱                   │
│ [🏠 安全區域] [⭐ 合作友善商家]  │  ← 新增商家標籤
│ ...                              │
│ 接收點序號：g-26-01-0001         │  ← 序號移到這裡（灰色小字）
│ [操作按鈕]                       │
└──────────────────────────────────┘
```

## 💻 代碼變更

### 1. 移除標題旁的序號 Badge

```tsx
// 修改前
<Modal
  title={selectedGateway?.location || "接收點詳情"}
  titleBadge={
    <span className="serial-badge">{selectedGateway.serialNumber}</span>
  }
>

// 修改後
<Modal
  title={selectedGateway?.location || "接收點詳情"}
>
```

### 2. 在 Badge 區域添加商家標籤

```tsx
<div className="gateway-badges">
  <span className={`badge badge-${selectedGateway.type}`}>
    {/* Type Badge */}
  </span>

  {/* 新增：合作友善商家標籤 */}
  {selectedGateway.isAD && (
    <span
      className="badge"
      style={{
        backgroundColor: "#dcfce7",
        color: "#16a34a",
        border: "1px solid #86efac",
      }}
    >
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
      </svg>
      合作友善商家
    </span>
  )}
</div>
```

### 3. 在內容最後添加序號區塊

```tsx
{/* 商家優惠區塊結束 */}

{/* 新增：Gateway 序號區塊 */}
<div
  style={{
    marginTop: "16px",
    paddingTop: "12px",
    borderTop: "1px solid #f3f4f6",
    textAlign: "center",
  }}
>
  <span
    style={{
      fontSize: "12px",
      color: "#9ca3af",
      fontWeight: "400",
    }}
  >
    接收點序號：{selectedGateway.serialNumber}
  </span>
</div>

<div className="modal-actions">
  {/* 操作按鈕 */}
</div>
```

## 📱 不同情境的顯示效果

### 情境 A：一般 Gateway（非商家）

```
📍 接收點詳情

📍 某某公園
[🏠 安全區域]

接收點序號：g-26-01-0001
[✓ 設為通知點] [關閉]
```

### 情境 B：商家 Gateway（isAD = true）

```
📍 接收點詳情

🏪 📍 星巴克咖啡
[🏠 安全區域] [⭐ 合作友善商家]
━━━━━━━━━━━━━━━━━
商家優惠
┌─────────────────────┐
│  Banner 圖片 (3:1)  │
└─────────────────────┘
春節特惠活動
全店商品 8 折優惠...
🔗 前往官網
━━━━━━━━━━━━━━━━━
接收點序號：g-26-01-0001
[✓ 設為通知點] [關閉]
```

### 情境 C：商家 Gateway（無優惠活動）

```
📍 接收點詳情

🏪 📍 便利商店
[🏠 安全區域] [⭐ 合作友善商家]

接收點序號：g-26-01-0002
[✓ 設為通知點] [關閉]
```

## 🎯 設計理念

### 1. 視覺層級優化

- **標題區域**：保持簡潔，只顯示位置名稱
- **內容區域**：
  - 上方：店家資訊和標籤（重點突出）
  - 中間：商家優惠內容（主要資訊）
  - 下方：序號資訊（次要資訊）
- **操作區域**：操作按鈕

### 2. 商家識別度提升

- **顏色語義**：綠色代表友善、合作關係
- **圖示輔助**：星星表示特色、優質商家
- **位置醒目**：與 Type Badge 並列，一眼可見

### 3. 資訊重要性排序

- **最重要**：店家名稱、標籤、優惠內容
- **次要**：序號、ID（技術資訊）
- **調整方案**：將序號移到底部，縮小字體，降低視覺權重

## 🔍 技術細節

### 顏色規範

| 元素             | 背景色  | 文字色  | 邊框色  |
| ---------------- | ------- | ------- | ------- |
| 合作友善商家標籤 | #dcfce7 | #16a34a | #86efac |
| 序號區塊分隔線   | -       | -       | #f3f4f6 |
| 序號文字         | -       | #9ca3af | -       |

### 尺寸規範

| 元素         | 字體大小   | 圖示大小 | 間距      |
| ------------ | ---------- | -------- | --------- |
| 商家標籤文字 | 繼承 badge | 14px     | -         |
| 序號文字     | 12px       | -        | 上方 12px |

### 佈局規範

- **序號區塊**：
  - 上邊距：16px
  - 上邊框：1px 實線
  - 內邊距（上）：12px
  - 文字對齊：置中

## ✅ 測試檢查清單

- [✓] 一般 Gateway 不顯示商家標籤
- [✓] isAD = true 的 Gateway 顯示商家標籤
- [✓] 標題區域不再顯示序號 Badge
- [✓] 序號顯示在內容最後（灰色小字）
- [✓] 序號上方有分隔線
- [✓] 商家標籤顏色正確（綠色系）
- [✓] 星星圖標正確顯示
- [✓] 文字大小和顏色符合設計規範
- [✓] 無 TypeScript Linter 錯誤

## 📝 修改的檔案

1. **liff/src/screens/map/MapScreen.tsx**
   - 移除 `titleBadge` 屬性
   - 在 `gateway-badges` 添加商家標籤
   - 在 `modal-actions` 前添加序號區塊

2. **LIFF_MAP_VISUAL_EXAMPLE.md**
   - 更新視覺示意圖
   - 更新佈局說明

3. **LIFF_MAP_STORE_FEATURE.md**
   - 更新功能說明
   - 添加標籤和序號的說明

## 🚀 未來可擴展功能

- [ ] 商家等級標籤（金牌、銀牌、銅牌商家）
- [ ] 商家評分顯示
- [ ] 複製序號功能
- [ ] 序號 QR Code 生成
- [ ] 商家認證標章
- [ ] 多語言支援（商家標籤文字）

## 📊 用戶體驗改進

### 改進前的問題

1. 序號顯示在標題旁，視覺重量過重
2. 商家 Gateway 與一般 Gateway 難以區分
3. 技術資訊（序號）與業務資訊（店家）混在一起

### 改進後的優勢

1. ✅ 標題區域更簡潔清爽
2. ✅ 商家一眼可辨識（綠色標籤）
3. ✅ 資訊層級清晰（重要資訊在上，技術資訊在下）
4. ✅ 序號仍然可見，但不干擾主要資訊
5. ✅ 符合用戶閱讀習慣（從上到下，從重要到次要）

# 商店管理功能更新

## 新增功能

### 1. 商店詳情頁面 (`StoreDetailPage.tsx`)

- **頁面路徑**：`/stores/:id`
- **主要功能**：
  - 顯示商店完整資訊
  - 左側圖片預覽區域
    - Logo 預覽（1:1 比例）
    - Banner 預覽（3:1 比例）
  - 右側表單編輯區域
  - 編輯模式切換
  - 即時圖片上傳和預覽
  - 返回列表按鈕

### 2. 商店列表頁面優化 (`StoresPage.tsx`)

#### 表格功能

- **圖片縮略圖顯示**
  - Logo：10x10 圓角縮略圖
  - Banner：20x8 圓角縮略圖
  - 每個圖片旁邊都有「查看」連結
- **點擊行跳轉**：點擊表格任意一行即可進入該商店的詳情頁
- **編輯按鈕**：點擊編輯按鈕會阻止行點擊事件，直接打開編輯 Modal

#### Modal 功能增強

- **即時圖片預覽**
  - Logo 預覽：128x128 (1:1)
  - Banner 預覽：最大寬度 384px，高度 128px (3:1)
- **上傳即預覽**：上傳圖片後立即顯示預覽
- **URL 輸入預覽**：手動輸入圖片 URL 也會即時預覽
- **圖片建議尺寸提示**
  - Logo：400x400 或更高（1:1 比例）
  - Banner：1200x400 或更高（3:1 比例）

### 3. 路由配置

在 `App.tsx` 中新增：

```tsx
<Route path="stores/:id" element={<StoreDetailPage />} />
```

### 4. Gateway Service 擴展

新增 `subscribeToOne` 方法：

```typescript
subscribeToOne: (id: string, callback: (data: Gateway | null) => void)
```

- 即時監聽單個商店的資料變更
- 使用 Firestore onSnapshot 實現
- 資料更新時自動觸發回調

## 技術細節

### 圖片預覽實現

#### Logo (1:1)

```css
padding-top: 100%; /* 創建 1:1 寬高比容器 */
```

#### Banner (3:1)

```css
padding-top: 33.33%; /* 創建 3:1 寬高比容器 */
```

### 狀態管理

- 使用 `watch` 監聽表單欄位變化
- 即時更新預覽圖片狀態
- 編輯/新增時分別設置初始預覽狀態

### 事件處理

- 使用 `e.stopPropagation()` 防止點擊編輯按鈕時觸發行點擊
- 使用 `e.stopPropagation()` 防止點擊連結時觸發行點擊
- 導航使用 `useNavigate` hook

## 使用流程

### 查看商店詳情

1. 進入商店管理頁面
2. 點擊任意商店行
3. 跳轉到該商店的詳情頁
4. 查看完整資訊和圖片預覽

### 編輯商店資訊

方式 1（列表頁快速編輯）：

1. 點擊商店行的編輯按鈕
2. 在 Modal 中編輯
3. 即時預覽上傳的圖片
4. 儲存

方式 2（詳情頁編輯）：

1. 進入商店詳情頁
2. 點擊「編輯」按鈕
3. 左側即時預覽圖片
4. 右側編輯表單
5. 點擊「儲存」或「取消」

### 新增商店

1. 點擊「新增店家」按鈕
2. 填寫店家資訊
3. 上傳 Logo 和 Banner
4. 即時預覽上傳結果
5. 儲存

## 檔案變更清單

### 新增檔案

- `src/pages/StoreDetailPage.tsx` - 商店詳情頁面

### 修改檔案

- `src/pages/StoresPage.tsx` - 添加圖片預覽和點擊跳轉
- `src/App.tsx` - 添加詳情頁路由
- `src/services/gatewayService.ts` - 添加 subscribeToOne 方法

## UI/UX 改進

### 視覺提升

- ✅ 表格中直接顯示圖片縮略圖，更直觀
- ✅ 圖片預覽區域清晰標示長寬比
- ✅ 空白預覽使用圖示佔位符
- ✅ 統一的圓角和邊框樣式

### 互動優化

- ✅ 點擊行即可跳轉，操作更便捷
- ✅ 即時圖片預覽，所見即所得
- ✅ 明確的上傳狀態提示（Loader 動畫）
- ✅ 建議尺寸提示，幫助用戶選擇合適圖片

### 響應式設計

- ✅ 詳情頁使用 Grid 佈局，大螢幕 1:2 分欄
- ✅ 小螢幕自動堆疊為單欄
- ✅ 圖片預覽自適應容器寬度

## 注意事項

1. **圖片尺寸建議**
   - Logo 建議使用正方形圖片（1:1），如 400x400
   - Banner 建議使用 3:1 比例圖片，如 1200x400
   - 圖片不會強制裁切，但會以 `object-cover` 顯示

2. **CORS 設置**
   - 確保 Firebase Storage CORS 已正確配置
   - 參考 `FIREBASE_STORAGE_SETUP.md` 文件

3. **權限控制**
   - 所有頁面都在 `ProtectedRoute` 保護下
   - 需要登入才能訪問

4. **即時更新**
   - 詳情頁使用 `subscribeToOne` 即時監聽
   - 其他使用者的更新會自動反映在頁面上

## 未來可擴展功能

- [ ] 圖片裁切功能（調整比例）
- [ ] 批量上傳圖片
- [ ] 圖片優化/壓縮
- [ ] 更多圖片格式驗證
- [ ] 拖拽上傳
- [ ] 圖片歷史記錄
